{% extends 'core/base.html' %}

{% block content %}
<div class="cart-view">
    <div class="cart-header">
        <h1>Shopping Cart</h1>
        <div class="cart-count-display">
            <span id="cart-items-count">{{ cart|length }} item{{ cart|length|pluralize }}</span>
        </div>
    </div>
    
    <div id="cart-content" class="cart-content">
        {% include 'store/cart_content.html' %}
    </div>
</div>

<script>
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.target.id === 'cart-content') {
            fetch('{% url "change_quantity" 0 %}?action=get_count', {
                method: 'GET',
                headers: {
                    'HX-Request': 'true'
                }
            })
            .then(response => response.text())
            .then(data => {
                const cartCount = document.getElementById('cart-count');
                if (cartCount) {
                    cartCount.innerHTML = data;
                }
                
                const cartItemsCount = document.getElementById('cart-items-count');
                if (cartItemsCount) {
                    const count = data.replace(/[()]/g, '');
                    cartItemsCount.textContent = `${count} item${count != '1' ? 's' : ''}`;
                }
            });
        }
    });
</script>
{% endblock %}